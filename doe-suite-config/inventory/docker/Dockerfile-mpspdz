# syntax=docker/dockerfile:experimental
FROM arc:latest

USER ubuntu
WORKDIR /home/ubuntu

# Install Rust
RUN curl https://sh.rustup.rs -sSf | bash -s -- -y
RUN echo 'source $HOME/.cargo/env' >> $HOME/.bashrc

# Configure Rust toolchains
RUN . $HOME/.cargo/env && rustup install 1.76.0
RUN . $HOME/.cargo/env && rustup default nightly-2024-02-04

# Clone and build mpc-consistency (uncomment if needed)
RUN --mount=type=ssh,mode=0666 git clone git@github.com:hiddely/mpc-consistency.git /home/ubuntu/mpc-consistency
RUN . $HOME/.cargo/env && cd /home/ubuntu/mpc-consistency && cargo build --release --features parallel

# Compile MP-SPDZ components (only if not already done in arc:latest)
RUN cd /home/ubuntu/code/MP-SPDZ && make -j8 libff
RUN cd /home/ubuntu/code/MP-SPDZ && make -j8 replicated-ring-party.x rep-ring-switch-party.x semi2k-party.x